Bootstrap: docker
From: ubuntu:24.04

%post

    # Update and install dependencies for samtools/htslib
    apt-get update
    apt-get install -y \
        build-essential \
        autoconf \
        automake \
        libncurses-dev \
        libbz2-dev \
        liblzma-dev \
        libcurl4-gnutls-dev \
        zlib1g-dev \
        git \
        curl \
        wget \
        perl \
        perl-base \
        perl-modules \
        perl-doc \
        cpanminus \
        jq \
        libmodule-build-tiny-perl \
    && apt-get clean

    # Install needed Perl modules for vcf2maf
    cpanm Archive::Zip
    cpanm List::Util
    cpanm Scalar::Util
    cpanm Time::HiRes
    cpanm DBI
    cpanm Set::IntervalTree
    cpanm Perl::Unsafe::Signals
    cpanm JSON
    cpanm JSON::XS
    cpanm LWP::Simple
    cpanm LWP::UserAgent

    ###########################################################
    # Install htslib (provides bgzip + tabix)
    ###########################################################

    export HTSLIB_VERSION=1.22.1
    wget https://github.com/samtools/htslib/releases/download/${HTSLIB_VERSION}/htslib-${HTSLIB_VERSION}.tar.bz2
    tar -xjf htslib-${HTSLIB_VERSION}.tar.bz2
    cd htslib-${HTSLIB_VERSION}
    ./configure --prefix=/usr/local
    make
    make install
    cd /

    # bgzip and tabix now installed in /usr/local/bin
    ###########################################################
    # Install samtools
    ###########################################################
    export SAMTOOLS_VERSION=1.22.1

    wget https://github.com/samtools/samtools/releases/download/${SAMTOOLS_VERSION}/samtools-${SAMTOOLS_VERSION}.tar.bz2
    tar -xjf samtools-${SAMTOOLS_VERSION}.tar.bz2

    cd samtools-${SAMTOOLS_VERSION}
    ./configure --prefix=/usr/local
    make
    make install
    cd /

    ###########################################################
    # Install vcf2maf
    ###########################################################
    curl -L -o vcf2maf.tar.gz https://github.com/mskcc/vcf2maf/archive/refs/tags/v1.6.22.tar.gz
    tar -zxf vcf2maf.tar.gz
    cd vcf2maf-1.6.22

    chmod +x vcf2maf.pl maf2vcf.pl
    mkdir -p /opt/vcf2maf
    cp -r * /opt/vcf2maf/

%environment
    export PATH=/usr/local/bin:$PATH
    export PATH=/opt/vcf2maf:$PATH

%labels
    Version "vcf2maf-1.6.22 + samtools-1.22.1 + htslib(tabix)-1.22.1"

%runscript
    exec vcf2maf.pl "$@"


